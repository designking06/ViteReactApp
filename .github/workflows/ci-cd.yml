name: React Vite CI/CD

on:
  push:
    branches:
      - main # Trigger the workflow when pushing to the main branch
  pull_request:
    branches:
      - main # Run this workflow when a pull request is made to main branch

jobs:
  build-and-test:
    runs-on: ubuntu-latest # Use a fresh virtual machine for each job

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4 # Action to check out your repo's code

      - name: Set up Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20' # Specify the Node.js version you use

      - name: Install dependencies
        run: npm ci # use ci instead of install for clean install

      - name: Run Linter
        run: npm run lint 
        
      - name: Run tests (Optional, if you have tests)
        run: npm test

      - name: Build project
        run: npm run build

      - name: Upload production artifacts
        uses: actions/upload-artifact@v4 # Save the build output for the deploy job
        with:
          name: build-artifact
          path: dist # The default output directory for Vite

  deploy:
    needs: build-and-test # This job runs only after build-and-test is successful
    runs-on: ubuntu-latest

    # Add environment variable or secrets for deployment if needed (e.g., if deploying to Vercel/Netlify)
    # environment: production

    steps:
      - name: Download build artifact
        uses: actions/download-artifact@v4
        with:
          name: build-artifact
          path: dist

      #- name: Deploy to GitHub Pages (Example Deployment Step)
      #  uses: peaceiris/actions-gh-pages@v3
      #  if: github.ref == 'refs/heads/main'
      #  with:
      #    github_token: ${{ secrets.GITHUB_TOKEN }}
      #    publish_dir: ./dist
          # Add a CNAME file if you use a custom domain
          # cname: example.com

      # --- Alternative Deployment Steps ---
      # For Vercel, you would use an action like:
      # - name: Deploy to Vercel
      #   uses: supercharge/vercel-action@v2
      #   with:
      #     prjId: ${{ secrets.VERCEL_PROJECT_ID }}
      #     orgId: ${{ secrets.VERCEL_ORG_ID }}
      #     token: ${{ secrets.VERCEL_TOKEN }}
